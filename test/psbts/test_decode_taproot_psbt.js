const {test} = require('@alexbosworth/tap');
const tinysecp = require('tiny-secp256k1');

const {decodePsbt} = require('./../../');

// Test scenarios
const tests = {
  input_internal_key_too_long: {
    args: {
      psbt: '70736274ff010071020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff02787c01000000000016001483a7e34bd99ff03a4962ef8a1a101bb295461ece606b042a010000001600147ac369df1b20e033d6116623957b0ac49f3c52e8000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a075701172102fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232000000',
    },
    msg: 'PSBT With PSBT_IN_TAP_INTERNAL_KEY key that is too long (incorrectly serialized as compressed DER)',
    err: 'ExpectedXOnlyPublicKeyForTapInternalKey',
  },

  input_key_path_signature_too_short: {
    args: {
      psbt: '70736274ff010071020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff02787c01000000000016001483a7e34bd99ff03a4962ef8a1a101bb295461ece606b042a010000001600147ac369df1b20e033d6116623957b0ac49f3c52e8000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a075701133f173bb3d36c074afb716fec6307a069a2e450b995f3c82785945ab8df0e24260dcd703b0cbf34de399184a9481ac2b3586db6601f026a77f7e4938481bc3475000000',
    },
    msg: 'PSBT With PSBT_KEY_PATH_SIG signature that is too short',
    err: 'UnexpectedSizeOfTaprootKeySignature',
  },

  input_key_path_signature_too_long: {
    args: {
      psbt: '70736274ff010071020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff02787c01000000000016001483a7e34bd99ff03a4962ef8a1a101bb295461ece606b042a010000001600147ac369df1b20e033d6116623957b0ac49f3c52e8000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757011342173bb3d36c074afb716fec6307a069a2e450b995f3c82785945ab8df0e24260dcd703b0cbf34de399184a9481ac2b3586db6601f026a77f7e4938481bc34751701aa000000',
    },
    msg: 'PSBT With PSBT_KEY_PATH_SIG signature that is too long',
    err: 'UnexpectedSizeOfTaprootKeySignature',
  },

  input_bip32_derivation_key_too_long: {
    args: {
      psbt: '70736274ff010071020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff02787c01000000000016001483a7e34bd99ff03a4962ef8a1a101bb295461ece606b042a010000001600147ac369df1b20e033d6116623957b0ac49f3c52e8000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757221602fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2321900772b2da75600008001000080000000800100000000000000000000',
    },
    msg: 'PSBT With PSBT_IN_TAP_BIP32_DERIVATION key that is too long (incorrectly serialized as compressed DER)',
    err: 'ExpectedTypeNumberAndXOnlyPublicKeyInKeyType',
  },

  output_internal_key_too_long: {
    args: {
      psbt: '70736274ff01007d020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff02887b0100000000001600142382871c7e8421a00093f754d91281e675874b9f606b042a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757000001052102fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa23200',
    },
    msg: 'PSBT With PSBT_OUT_TAP_INTERNAL_KEY key that is too long (incorrectly serialized as compressed DER)',
    err: 'InvalidOutputXOnlyPublicKeyForTapInternalKey',
  },

  output_bip32_derivation_key_too_long: {
    args: {
      psbt: '70736274ff01007d020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff02887b0100000000001600142382871c7e8421a00093f754d91281e675874b9f606b042a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a07570000220702fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2321900772b2da7560000800100008000000080010000000000000000',
    },
    msg: 'PSBT With PSBT_OUT_TAP_BIP32_DERIVATION key that is too long (incorrectly serialized as compressed DER)',
    err: 'ExpectedTypeNumberAndXOnlyPublicKeyInKeyType',
  },

  input_script_sig_key_too_long: {
    args: {
      psbt: '70736274ff01005e02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a01000000225120030da4fce4f7db28c2cb2951631e003713856597fe963882cb500e68112cca63000000000001012b00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b6924214022cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b094089756aa3739ccc689ec0fcf3a360be32cc0b59b16e93a1e8bb4605726b2ca7a3ff706c4176649632b2cc68e1f912b8a578e3719ce7710885c7a966f49bcd43cb0000',
    },
    msg: 'PSBT With PSBT_IN_TAP_SCRIPT_SIG key that is too long (incorrectly serialized as compressed DER)',
    err: 'UnexpectedSizeOfTaprootScriptSigKeyType',
  },

  input_script_signature_too_long: {
    args: {
      psbt: '70736274ff01005e02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a01000000225120030da4fce4f7db28c2cb2951631e003713856597fe963882cb500e68112cca63000000000001012b00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b69241142cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b094289756aa3739ccc689ec0fcf3a360be32cc0b59b16e93a1e8bb4605726b2ca7a3ff706c4176649632b2cc68e1f912b8a578e3719ce7710885c7a966f49bcd43cb01010000',
    },
    msg: 'PSBT With PSBT_IN_TAP_SCRIPT_SIG signature that is too long',
    err: 'UnexpectedSizeOfTaprootScriptSignature',
  },

  input_script_signature_too_short: {
    args: {
      psbt: '70736274ff01005e02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a01000000225120030da4fce4f7db28c2cb2951631e003713856597fe963882cb500e68112cca63000000000001012b00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b69241142cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b093f89756aa3739ccc689ec0fcf3a360be32cc0b59b16e93a1e8bb4605726b2ca7a3ff706c4176649632b2cc68e1f912b8a578e3719ce7710885c7a966f49bcd430000',
    },
    msg: 'PSBT With PSBT_IN_TAP_SCRIPT_SIG signature that is too short',
    err: 'UnexpectedSizeOfTaprootScriptSignature',
  },

  input_leaf_script_too_long: {
    args: {
      psbt: '70736274ff01005e02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a01000000225120030da4fce4f7db28c2cb2951631e003713856597fe963882cb500e68112cca63000000000001012b00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b6926315c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac06f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f80023202cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2acc00000',
    },
    msg: 'PSBT With PSBT_IN_TAP_LEAF_SCRIPT Control block that is too long',
    err: 'ExpectedControlBlockForTapLeafScriptInput',
  },

  input_leaf_script_too_short: {
    args: {
      psbt: '70736274ff01005e02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a01000000225120030da4fce4f7db28c2cb2951631e003713856597fe963882cb500e68112cca63000000000001012b00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b6926115c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac06f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e123202cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2acc00000',
    },
    msg: 'PSBT With PSBT_IN_TAP_LEAF_SCRIPT Control block that is too short',
    err: 'ExpectedControlBlockForTapLeafScriptInput',
  },

  simple_p2tr_spend: {
    args: {
      psbt: '70736274ff010052020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f9720744969000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a07572116fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2321900772b2da75600008001000080000000800100000000000000011720fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232002202036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d818772b2da7540000800100008000000080000000000000000000',
    },
    msg: 'PSBT with one P2TR key only input with internal key and its derivation path',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 5000000000,
          script_pub: '51205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757'
        },
        bip32_derivations: [{
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/1/0",
          public_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        }],
        taproot_internal_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
      }],
      outputs: [{
        bip32_derivation: {
          path: "m/84'/1'/0'/0/0",
          fingerprint: '772b2da7',
          public_key: '036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d8',
        },
      }],
      pairs: [
        {
          type: '00',
          value: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f972074496900000000',
        },
        {
          type: '01',
          value: '00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        {
          type: '16fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
          value: '00772b2da75600008001000080000000800100000000000000',
        },
        {
          type: '17',
          value: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        },
        {
          type: '02036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d8',
          value: '772b2da75400008001000080000000800000000000000000',
        }
      ],
      unsigned_transaction: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f972074496900000000',
    },
  },

  standard_taproot_psbt: {
    args: {
      psbt: '70736274ff010052020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f9720744969000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a07572116fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2321900772b2da75600008001000080000000800100000000000000011720fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232002202036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d818772b2da7540000800100008000000080000000000000000000',
    },
    msg: 'A standard p2tr psbt is decoded',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 5000000000,
          script_pub: '51205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        bip32_derivations: [{
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/1/0",
          public_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        }],
        taproot_internal_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
      }],
      outputs: [{
        bip32_derivation: {
          path: "m/84'/1'/0'/0/0",
          fingerprint: '772b2da7',
          public_key: '036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d8',
        },
      }],
      pairs: [
        {
          type: '00',
          value: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f972074496900000000',
        },
        {
          type: '01',
          value: '00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        {
          type: '16fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
          value: '00772b2da75600008001000080000000800100000000000000',
        },
        {
          type: '17',
          value: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        },
        {
          type: '02036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d8',
          value: '772b2da75400008001000080000000800000000000000000',
        },
      ],
      unsigned_transaction: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f972074496900000000',
    },
  },

  decode_a_taproot_psbt: {
    args: {
      psbt: '70736274ff0100710200000001982346b81b3dc75bc9be7c857cabd7870d971d44bd947ec1b0c37b6ee06ef02e0100000000000000000240420f000000000016001488a82c7582079ebe05e32378839e6810cbf4d3a616298900000000001600140247048d50b6ed78a1e7b90c320e77ddcb2954c5000000000001012b8096980000000000225120d388a192a856c33ee73f72b7ec33caf9e49881fcf5579f76669d815159ea061c2116620763e2113dc4d27d65153d6b889d4e5e0e3ee990e53c75d0ca38f89c45328a1900000000005600008000000080000000800000000000000000000000',
    },
    msg: 'A taproot PSBT is decoded',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 10000000,
          script_pub: '5120d388a192a856c33ee73f72b7ec33caf9e49881fcf5579f76669d815159ea061c',
        },
        bip32_derivations: [{
          fingerprint: '00000000',
          leaf_hashes: [],
          path: "m/86'/0'/0'/0/0",
          public_key: '620763e2113dc4d27d65153d6b889d4e5e0e3ee990e53c75d0ca38f89c45328a'
        }],
      }],
      outputs: [{}, {}],
      pairs: [
        {
          type: '00',
          value: '0200000001982346b81b3dc75bc9be7c857cabd7870d971d44bd947ec1b0c37b6ee06ef02e0100000000000000000240420f000000000016001488a82c7582079ebe05e32378839e6810cbf4d3a616298900000000001600140247048d50b6ed78a1e7b90c320e77ddcb2954c500000000',
        },
        {
          type: '01',
          value: '8096980000000000225120d388a192a856c33ee73f72b7ec33caf9e49881fcf5579f76669d815159ea061c',
        },
        {
          type: '16620763e2113dc4d27d65153d6b889d4e5e0e3ee990e53c75d0ca38f89c45328a',
          value: '00000000005600008000000080000000800000000000000000',
        },
      ],
      unsigned_transaction: '0200000001982346b81b3dc75bc9be7c857cabd7870d971d44bd947ec1b0c37b6ee06ef02e0100000000000000000240420f000000000016001488a82c7582079ebe05e32378839e6810cbf4d3a616298900000000001600140247048d50b6ed78a1e7b90c320e77ddcb2954c500000000',
    },
  },

  single_sign_p2tr: {
    args: {
      psbt: '70736274ff010052020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f9720744969000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757011340bb53ec917bad9d906af1ba87181c48b86ace5aae2b53605a725ca74625631476fc6f5baedaf4f2ee0f477f36f58f3970d5b8273b7e497b97af2e3f125c97af342116fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2321900772b2da75600008001000080000000800100000000000000011720fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232002202036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d818772b2da7540000800100008000000080000000000000000000',
    },
    msg: 'PSBT with one P2TR key only input with internal key, its derivation path, and signature',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 5000000000,
          script_pub: '51205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        taproot_key_spend_sig: 'bb53ec917bad9d906af1ba87181c48b86ace5aae2b53605a725ca74625631476fc6f5baedaf4f2ee0f477f36f58f3970d5b8273b7e497b97af2e3f125c97af34',
        bip32_derivations: [{
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/1/0",
          public_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        }],
        sighash_type: 0,
        taproot_internal_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
      }],
      outputs: [{
        bip32_derivation: {
          path: "m/84'/1'/0'/0/0",
          fingerprint: '772b2da7',
          public_key: '036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d8',
        },
      }],
      pairs: [
        {
          type: '00',
          value: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f972074496900000000',
        },
        {
          type: '01',
          value: '00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        {
          type: '13',
          value: 'bb53ec917bad9d906af1ba87181c48b86ace5aae2b53605a725ca74625631476fc6f5baedaf4f2ee0f477f36f58f3970d5b8273b7e497b97af2e3f125c97af34',
        },
        {
          type: '16fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
          value: '00772b2da75600008001000080000000800100000000000000',
        },
        {
          type: '17',
          value: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        },
        {
          type: '02036b772a6db74d8753c98a827958de6c78ab3312109f37d3e0304484242ece73d8',
          value: '772b2da75400008001000080000000800000000000000000',
        }
      ],
      unsigned_transaction: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a01000000160014768e1eeb4cf420866033f80aceff0f972074496900000000',
    },
  },

  p2tr_key_output: {
    args: {
      psbt: '70736274ff01005e020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd743000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a07572116fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2321900772b2da75600008001000080000000800100000000000000011720fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232000105201124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e67121071124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e6711900772b2da7560000800100008000000080000000000500000000',
    },
    msg: 'PSBT with one P2TR key only output with internal key and its derivation path',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 5000000000,
          script_pub: '51205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        bip32_derivations: [{
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/1/0",
          public_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        }],
        taproot_internal_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
      }],
      outputs: [{
        taproot_internal_key: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        bip32_derivation: {
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/0/5",
          public_key: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        },
      }],
      pairs: [
        {
          type: '00',
          value: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd74300000000',
        },
        {
          type: '01',
          value: '00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        {
          type: '16fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
          value: '00772b2da75600008001000080000000800100000000000000',
        },
        {
          type: '17',
          value: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        },
        {
          type: '05',
          value: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        },
        {
          type: '071124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
          value: '00772b2da75600008001000080000000800000000005000000',
        },
      ],
      unsigned_transaction: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd74300000000',
    },
  },

  p2tr_with_dummy_internal_key: {
    args: {
      psbt: '70736274ff01005e02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd743000000000001012b00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b6926215c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac06f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f823202cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2acc04215c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac097c6e6fea5ff714ff5724499990810e406e98aa10f5bf7e5f6784bc1d0a9a6ce23204320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2acc06215c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f82320fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9acc021162cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d23901cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09772b2da7560000800100008002000080000000000000000021164320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b23901115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8772b2da75600008001000080010000800000000000000000211650929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac005007c461e5d2116fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca939016f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970772b2da7560000800100008003000080000000000000000001172050929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0011820f0362e2f75a6f420a5bde3eb221d96ae6720cf25f81890c95b1d775acb515e65000105201124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e67121071124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e6711900772b2da7560000800100008000000080000000000500000000',
    },
    msg: 'PSBT with one P2TR script path only input with dummy internal key, scripts, derivation paths for keys in the scripts, and merkle root',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 5000000000,
          script_pub: '5120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b692',
        },
        taproot_control_block: 'c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8',
        taproot_leaf_script: '20fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9ac',
        taproot_leaf_version: 192,
        bip32_derivations: [
          {
            fingerprint: '772b2da7',
            leaf_hashes: [
              'cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09'
            ],
            path: "m/86'/1'/2'/0/0",
            public_key: '2cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2',
          },
          {
            fingerprint: '772b2da7',
            leaf_hashes: [
              '115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8'
            ],
            path: "m/86'/1'/1'/0/0",
            public_key: '4320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2',
          },
          {
            fingerprint: '7c461e5d',
            leaf_hashes: [],
            path: undefined,
            public_key: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
          },
          {
            fingerprint: '772b2da7',
            leaf_hashes: [
              '6f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970'
            ],
            path: "m/86'/1'/3'/0/0",
            public_key: 'fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9',
          },
        ],
        taproot_internal_key: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
        taproot_root_hash: 'f0362e2f75a6f420a5bde3eb221d96ae6720cf25f81890c95b1d775acb515e65',
      }],
      outputs: [{
        taproot_internal_key: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        bip32_derivation: {
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/0/5",
          public_key: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        },
      }],
      pairs: [
        {
          type: '00',
          value: '02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd74300000000',
        },
        {
          type: '01',
          value: '00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b692',
        },
        {
          type: '15c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac06f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8',
          value: '202cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2acc0',
        },
        {
          type: '15c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac097c6e6fea5ff714ff5724499990810e406e98aa10f5bf7e5f6784bc1d0a9a6ce',
          value: '204320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2acc0',
        },
        {
          type: '15c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8',
          value: '20fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9acc0',
        },
        {
          type: '162cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2',
          value: '01cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09772b2da75600008001000080020000800000000000000000',
        },
        {
          type: '164320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2',
          value: '01115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8772b2da75600008001000080010000800000000000000000',
        },
        {
          type: '1650929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
          value: '007c461e5d',
        },
        {
          type: '16fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9',
          value: '016f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970772b2da75600008001000080030000800000000000000000',
        },
        {
          type: '17',
          value: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
        },
        {
          type: '18',
          value: 'f0362e2f75a6f420a5bde3eb221d96ae6720cf25f81890c95b1d775acb515e65',
        },
        {
          type: '05',
          value: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        },
        {
          type: '071124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
          value: '00772b2da75600008001000080000000800000000005000000',
        },
      ],
      unsigned_transaction: '02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd74300000000',
    },
  },

  p2tr_with_script_key: {
    args: {
      psbt: '70736274ff01005e020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a010000002251200a8cbdc86de1ce1c0f9caeb22d6df7ced3683fe423e05d1e402a879341d6f6f5000000000001012b00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a07572116fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2321900772b2da75600008001000080000000800100000000000000011720fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa2320001052050929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac001066f02c02220736e572900fe1252589a2143c8f3c79f71a0412d2353af755e9701c782694a02ac02c02220631c5f3b5832b8fbdebfb19704ceeb323c21f40f7a24f43d68ef0cc26b125969ac01c0222044faa49a0338de488c8dfffecdfb6f329f380bd566ef20c8df6d813eab1c4273ac210744faa49a0338de488c8dfffecdfb6f329f380bd566ef20c8df6d813eab1c42733901f06b798b92a10ed9a9d0bbfd3af173a53b1617da3a4159ca008216cd856b2e0e772b2da75600008001000080010000800000000003000000210750929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac005007c461e5d2107631c5f3b5832b8fbdebfb19704ceeb323c21f40f7a24f43d68ef0cc26b125969390118ace409889785e0ea70ceebb8e1ca892a7a78eaede0f2e296cf435961a8f4ca772b2da756000080010000800200008000000000030000002107736e572900fe1252589a2143c8f3c79f71a0412d2353af755e9701c782694a02390129a5b4915090162d759afd3fe0f93fa3326056d0b4088cb933cae7826cb8d82c772b2da7560000800100008003000080000000000300000000',
    },
    msg: 'PSBT with one P2TR script path only output with dummy internal key, taproot tree, and script key derivation paths',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 5000000000,
          script_pub: '51205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        bip32_derivations: [{
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/1/0",
          public_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        }],
        taproot_internal_key: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
      }],
      outputs: [{
        taproot_internal_key: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
        taproot_script_tree: [
          {
            depth: 2,
            version: 192,
            script: '20736e572900fe1252589a2143c8f3c79f71a0412d2353af755e9701c782694a02ac',
          },
          {
            depth: 2,
            version: 192,
            script: '20631c5f3b5832b8fbdebfb19704ceeb323c21f40f7a24f43d68ef0cc26b125969ac',
          },
          {
            depth: 1,
            version: 192,
            script: '2044faa49a0338de488c8dfffecdfb6f329f380bd566ef20c8df6d813eab1c4273ac',
          },
        ],
        bip32_derivation: {
          fingerprint: '772b2da7',
          leaf_hashes: [
            '29a5b4915090162d759afd3fe0f93fa3326056d0b4088cb933cae7826cb8d82c'
          ],
          path: "m/86'/1'/3'/0/3",
          public_key: '736e572900fe1252589a2143c8f3c79f71a0412d2353af755e9701c782694a02'
        },
      }],
      pairs: [
        {
          type: '00',
          value: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a010000002251200a8cbdc86de1ce1c0f9caeb22d6df7ced3683fe423e05d1e402a879341d6f6f500000000',
        },
        {
          type: '01',
          value: '00f2052a010000002251205a2c2cf5b52cf31f83ad2e8da63ff03183ecd8f609c7510ae8a48e03910a0757',
        },
        {
          type: '16fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
          value: '00772b2da75600008001000080000000800100000000000000',
        },
        {
          type: '17',
          value: 'fe349064c98d6e2a853fa3c9b12bd8b304a19c195c60efa7ee2393046d3fa232',
        },
        {
          type: '05',
          value: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
        },
        {
          type: '06',
          value: '02c02220736e572900fe1252589a2143c8f3c79f71a0412d2353af755e9701c782694a02ac02c02220631c5f3b5832b8fbdebfb19704ceeb323c21f40f7a24f43d68ef0cc26b125969ac01c0222044faa49a0338de488c8dfffecdfb6f329f380bd566ef20c8df6d813eab1c4273ac',
        },
        {
          type: '0744faa49a0338de488c8dfffecdfb6f329f380bd566ef20c8df6d813eab1c4273',
          value: '01f06b798b92a10ed9a9d0bbfd3af173a53b1617da3a4159ca008216cd856b2e0e772b2da75600008001000080010000800000000003000000',
        },
        {
          type: '0750929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
          value: '007c461e5d',
        },
        {
          type: '07631c5f3b5832b8fbdebfb19704ceeb323c21f40f7a24f43d68ef0cc26b125969',
          value: '0118ace409889785e0ea70ceebb8e1ca892a7a78eaede0f2e296cf435961a8f4ca772b2da75600008001000080020000800000000003000000',
        },
        {
          type: '07736e572900fe1252589a2143c8f3c79f71a0412d2353af755e9701c782694a02',
          value: '0129a5b4915090162d759afd3fe0f93fa3326056d0b4088cb933cae7826cb8d82c772b2da75600008001000080030000800000000003000000',
        },
      ],
      unsigned_transaction: '020000000127744ababf3027fe0d6cf23a96eee2efb188ef52301954585883e69b6624b2420000000000ffffffff0148e6052a010000002251200a8cbdc86de1ce1c0f9caeb22d6df7ced3683fe423e05d1e402a879341d6f6f500000000',
    },
  },

  decode_a_taproot_psbt_with_leaf_spend: {
    args: {
      psbt: '70736274ff01005e02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd743000000000001012b00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b69241142cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b0940bf818d9757d6ffeb538ba057fb4c1fc4e0f5ef186e765beb564791e02af5fd3d5e2551d4e34e33d86f276b82c99c79aed3f0395a081efcd2cc2c65dd7e693d7941144320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f840e1f1ab6fabfa26b236f21833719dc1d428ab768d80f91f9988d8abef47bfb863bb1f2a529f768c15f00ce34ec283cdc07e88f8428be28f6ef64043c32911811a4114fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca96f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae97040ec1f0379206461c83342285423326708ab031f0da4a253ee45aafa5b8c92034d8b605490f8cd13e00f989989b97e215faa36f12dee3693d2daccf3781c1757f66215c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac06f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f823202cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2acc04215c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac097c6e6fea5ff714ff5724499990810e406e98aa10f5bf7e5f6784bc1d0a9a6ce23204320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2acc06215c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f82320fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9acc021162cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d23901cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09772b2da7560000800100008002000080000000000000000021164320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b23901115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8772b2da75600008001000080010000800000000000000000211650929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac005007c461e5d2116fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca939016f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970772b2da7560000800100008003000080000000000000000001172050929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0011820f0362e2f75a6f420a5bde3eb221d96ae6720cf25f81890c95b1d775acb515e65000105201124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e67121071124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e6711900772b2da7560000800100008000000080000000000500000000',
    },
    msg: 'A taproot PSBT with leaf spend is decoded',
    result: {
      inputs: [{
        witness_utxo: {
          tokens: 5000000000,
          script_pub: '5120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b692',
        },
        sighash_type: 0,
        taproot_leaf_hash: '6f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970',
        taproot_leaf_public_key: 'fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9',
        taproot_script_signature: 'ec1f0379206461c83342285423326708ab031f0da4a253ee45aafa5b8c92034d8b605490f8cd13e00f989989b97e215faa36f12dee3693d2daccf3781c1757f6',
        taproot_control_block: 'c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8',
        taproot_leaf_script: '20fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9ac',
        taproot_leaf_version: 192,
        bip32_derivations: [
          {
            fingerprint: '772b2da7',
            leaf_hashes: [
              'cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09'
            ],
            path: "m/86'/1'/2'/0/0",
            public_key: '2cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2',
          },
          {
            fingerprint: '772b2da7',
            leaf_hashes: [
              '115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8'
            ],
            path: "m/86'/1'/1'/0/0",
            public_key: '4320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2',
          },
          {
            fingerprint: '7c461e5d',
            leaf_hashes: [],
            path: undefined,
            public_key: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
          },
          {
            fingerprint: '772b2da7',
            leaf_hashes: [
              '6f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970'
            ],
            path: "m/86'/1'/3'/0/0",
            public_key: 'fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9',
          }
        ],
        taproot_internal_key: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
        taproot_root_hash: 'f0362e2f75a6f420a5bde3eb221d96ae6720cf25f81890c95b1d775acb515e65',
      }],
      outputs: [{
        taproot_internal_key: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        bip32_derivation: {
          fingerprint: '772b2da7',
          leaf_hashes: [],
          path: "m/86'/1'/0'/0/5",
          public_key: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        },
      }],
      pairs: [
        {
          type: '00',
          value: '02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd74300000000',
        },
        {
          type: '01',
          value: '00f2052a01000000225120c2247efbfd92ac47f6f40b8d42d169175a19fa9fa10e4a25d7f35eb4dd85b692',
        },
        {
          type: '142cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09',
          value: 'bf818d9757d6ffeb538ba057fb4c1fc4e0f5ef186e765beb564791e02af5fd3d5e2551d4e34e33d86f276b82c99c79aed3f0395a081efcd2cc2c65dd7e693d79',
        },
        {
          type: '144320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8',
          value: 'e1f1ab6fabfa26b236f21833719dc1d428ab768d80f91f9988d8abef47bfb863bb1f2a529f768c15f00ce34ec283cdc07e88f8428be28f6ef64043c32911811a',
        },
        {
          type: '14fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca96f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970',
          value: 'ec1f0379206461c83342285423326708ab031f0da4a253ee45aafa5b8c92034d8b605490f8cd13e00f989989b97e215faa36f12dee3693d2daccf3781c1757f6',
        },
        {
          type: '15c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac06f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8',
          value: '202cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2acc0',
        },
        {
          type: '15c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac097c6e6fea5ff714ff5724499990810e406e98aa10f5bf7e5f6784bc1d0a9a6ce',
          value: '204320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2acc0',
        },
        {
          type: '15c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8',
          value: '20fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9acc0',
        },
        {
          type: '162cb13ac68248de806aa6a3659cf3c03eb6821d09c8114a4e868febde865bb6d2',
          value: '01cd970e15f53fc0c82f950fd560ffa919b76172be017368a89913af074f400b09772b2da75600008001000080020000800000000000000000',
        },
        {
          type: '164320b0bf16f011b53ea7be615924aa7f27e5d29ad20ea1155d848676c3bad1b2',
          value: '01115f2e490af7cc45c4f78511f36057ce5c5a5c56325a29fb44dfc203f356e1f8772b2da75600008001000080010000800000000000000000',
        },
        {
          type: '1650929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
          value: '007c461e5d',
        },
        {
          type: '16fa0f7a3cef3b1d0c0a6ce7d26e17ada0b2e5c92d19efad48b41859cb8a451ca9',
          value: '016f7d62059e9497a1a4a267569d9876da60101aff38e3529b9b939ce7f91ae970772b2da75600008001000080030000800000000000000000',
        },
        {
          type: '17',
          value: '50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0',
        },
        {
          type: '18',
          value: 'f0362e2f75a6f420a5bde3eb221d96ae6720cf25f81890c95b1d775acb515e65',
        },
        {
          type: '05',
          value: '1124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
        },
        {
          type: '071124da7aec92ccd06c954562647f437b138b95721a84be2bf2276bbddab3e671',
          value: '00772b2da75600008001000080000000800000000005000000',
        },
      ],
      unsigned_transaction: '02000000019bd48765230bf9a72e662001f972556e54f0c6f97feb56bcb5600d817f6995260100000000ffffffff0148e6052a0100000022512083698e458c6664e1595d75da2597de1e22ee97d798e706c4c0a4b5a9823cd74300000000',
    },
  },
};

// Run the tests
Object.keys(tests).map(t => tests[t]).forEach(({args, err, msg, result}) => {
  return test(msg, async ({end, strictSame, throws}) => {
    args.ecp = (await import('ecpair')).ECPairFactory(tinysecp);

    if (!!err) {
      throws(() => decodePsbt(args), new Error(err), 'Got expected error');

      return end();
    }

    const res = decodePsbt(args);

    strictSame(res, result, 'Got expected result');

    return end();
  });
});
